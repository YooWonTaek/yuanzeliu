{% include base_path %}

<!-- start custom head snippets -->

<!-- Support for Academicons -->
<link rel="stylesheet" href="{{ base_path }}/assets/css/academicons.css"/>

<!-- favicon from https://commons.wikimedia.org/wiki/File:OOjs_UI_icon_academic-progressive.svg -->
<link rel="apple-touch-icon" sizes="180x180" href="{{ base_path }}/images/apple-touch-icon-180x180.png"/>
<link rel="icon" type="image/svg+xml" href="{{ base_path }}/images/favicon.svg"/>
<link rel="icon" type="image/png" href="{{ base_path }}/images/favicon-32x32.png" sizes="32x32"/>
<link rel="icon" type="image/png" href="{{ base_path }}/images/favicon-192x192.png" sizes="192x192"/>
<link rel="manifest" href="{{ base_path }}/images/manifest.json"/>
<link rel="icon" href="/images/favicon.ico"/>
<meta name="theme-color" content="#ffffff"/>

<script>
// Open all external links in a new tab (site-wide)
// Use window.load (fires after everything is rendered) + MutationObserver (covers late DOM changes)
(function () {
  function retargetExternalLinks(root) {
    var host  = location.hostname;
    var links = (root || document).getElementsByTagName('a');
    for (var i = 0; i < links.length; i++) {
      var a    = links[i];
      var href = a.getAttribute('href') || '';

      // Skip anchors and non-http(s) schemes
      if (!href || href[0] === '#' ||
          href.startsWith('mailto:') ||
          href.startsWith('tel:') ||
          href.startsWith('javascript:')) continue;

      // External if hostname differs from current site
      if (a.hostname && a.hostname !== host) {
        a.target = '_blank';
        a.rel = (a.rel ? a.rel + ' ' : '') + 'noopener noreferrer';
      }
    }
  }

  // Run after the whole page (including sidebar) has finished loading
  window.addEventListener('load', function () {
    retargetExternalLinks(document);

    // Also observe future DOM changes (e.g., content injected later)
    try {
      var mo = new MutationObserver(function (mutations) {
        for (var m of mutations) {
          if (m.addedNodes) {
            for (var n of m.addedNodes) {
              if (n.nodeType === 1) retargetExternalLinks(n);
            }
          }
        }
      });
      mo.observe(document.body, { childList: true, subtree: true });
    } catch (e) { /* older browsers can ignore */ }
  });
})();
</script>

<!-- end custom head snippets -->
